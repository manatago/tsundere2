# マイルストーン3: イベント通知とツンデレ解説

## 1. 機能要件

### 1.1 基本機能
- Google Calendarからのイベント取得
  - 昨日の予定
  - 今日の予定
  - 明日の予定
- ツンデレな幼馴染キャラクターによるイベント解説
- イベントリストの表示

### 1.2 UI/UX要件
- キャラクター画像の中央表示（画面の30%）
- 画面下部に3つのボタン配置
  - 「昨日の予定」
  - 「今日の予定」
  - 「明日の予定」
- イベントとツンデレ解説の吹き出し表示
- ローディング表示

## 2. 技術設計

### 2.1 データ構造
```typescript
interface CalendarEvent {
  id: string;
  title: string;
  start: Date;
  end: Date;
  description?: string;
  location?: string;
}

interface EventsResponse {
  events: CalendarEvent[];
  message: string;  // ツンデレキャラによる解説
}

interface CacheData {
  timestamp: number;
  data: EventsResponse;
}

interface EventCache {
  [key: string]: CacheData;  // 日付文字列をキー
}
```

### 2.2 コンポーネント構造
- Home/
  - CharacterDisplay: キャラクター画像表示
  - EventList: イベント一覧
  - CharacterMessage: ツンデレ解説
  - DateSelector: 日付選択ボタン群（下部固定）

### 2.3 メッセージ生成プロンプト
```typescript
const PROMPTS = {
  past: `
以下の予定について、ツンデレな幼馴染の女の子として300文字以上で解説してください。
予定は昨日のものなので、実施済みという前提で、相手（あんた）の対応についてツッコミを入れたり、
褒めたり、怒ったりしながら解説してください。
幼馴染らしく、相手のことを「あんた」と呼び、親しみがありながらもツンツンした態度で接してください。

予定：
{events}
`,
  
  present: `
以下の予定について、ツンデレな幼馴染の女の子として300文字以上で解説してください。
予定は本日のものなので、実施前または実施中という前提で、相手（あんた）に対して
準備を催促したり、心配したり、応援したりしながら解説してください。
幼馴染らしく、相手のことを「あんた」と呼び、親しみがありながらもツンツンした態度で接してください。

予定：
{events}
`,
  
  future: `
以下の予定について、ツンデレな幼馴染の女の子として300文字以上で解説してください。
予定は明日のものなので、事前準備が必要という前提で、相手（あんた）に対して
アドバイスしたり、警告したり、心配したりしながら解説してください。
幼馴染らしく、相手のことを「あんた」と呼び、親しみがありながらもツンツンした態度で接してください。

予定：
{events}
`,

  noEvents: `
その日の予定について、ツンデレな幼馴染の女の子として300文字以上でコメントしてください。
予定が入っていない状況について、相手（あんた）に対して
心配したり、アドバイスしたり、からかったりしながら話してください。
幼馴染らしく、相手のことを「あんた」と呼び、親しみがありながらもツンツンした態度で接してください。

日付：{date}
`
};
```

## 4. UI/UXデザイン

### 4.1 ホーム画面レイアウト
```
┌─────────────────────────────┐
│ TSUNDERE-CALENDAR    ⚙️    │
├─────────────────────────────┤
│                            │
│     [キャラクター画像]      │
│                            │
│ 【イベントリスト】          │
│ ・13:00 会議              │
│ ・15:00 打ち合わせ        │
│                            │
│ 💬 あんた、また会議の      │
│   資料準備してないで       │
│   しょう？いつもいつも     │
│   ギリギリになって...      │
│   （続く）                 │
│                            │
├─────────────────────────────┤
│ [昨日] [今日] [明日]       │
└─────────────────────────────┘
```

### 4.2 レイアウトの詳細
- キャラクター画像: 画面中央上部に配置（画面の約30%）
- イベントリスト: キャラクター画像の下に配置
- メッセージ吹き出し: イベントリストの下に配置
- 日付選択ボタン: 画面下部に固定（フッター）

## 5. エラーハンドリング

### 5.1 API関連
- ネットワークエラー
- 認証エラー
- レートリミット超過
- データ取得失敗

### 5.2 表示関連
- イベントがない場合も専用のメッセージを生成
- 読み込み中はLoadingSpinnerを表示
- エラー時の表示

## 6. キャッシュ戦略

### 6.1 イベントデータ
- 当日と前後1日分をキャッシュ
- キャッシュ有効期限: 5分
- キャッシュ更新の非同期実行

### 6.2 メッセージ
- 生成したツンデレ解説をキャッシュ
- 同一イベントリストの場合は再利用
- キャッシュ有効期限: 5分

## 7. トランジション効果

### 7.1 画面遷移
- シンプルなフェードイン/アウト
- 遷移時間: 200ms

### 7.2 コンテンツ更新
- メッセージとイベントリストのスムーズな更新
- ローディング中の適切な表示